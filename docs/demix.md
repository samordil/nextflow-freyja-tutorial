# **Writing freyja_demix.nf Module**

## **Step 2: Writing the `freyja_demix.nf` Module**  

The `freyja_demix.nf` module contains the `FREYJA_DEMIX` process, which takes the output from `FREYJA_VARIANTS` and processes it further.

It:

- Accepts a `.variant` file and a `.depths` file as input.
- Runs `freyja demix` command.
- Produces a `.tsv` file containing the final results.

Now open you text editor or run:

```bash
nano modules/freyja_demix.nf
```

Here is the full Code for `FREYJA_DEMIX`

```nextflow
process FREYJA_DEMIX {
    
    input:
        path variant_file
        path depth_file

    output:
        path "${sample_basename}.tsv"

    script:
    sample_basename = variant_file.simpleName

        """
        freyja demix $variant_file $depth_file --output ${sample_basename}.tsv
        """
}
```

Let's break it down:

### **Declaring the Input Files**
```nextflow
    input:
        path variant_file
        path depth_file
```

- `variant_file` – The .variant file generated by the `FREYJA_VARIANTS` process.
- `depth_file` – The .depths file generated by the `FREYJA_VARIANTS` process.
- These files serve as inputs for `FREYJA_VARIANTS`, which analyzes the data.

### **Declaring the Output File**
```nextflow
    output:
        path "${sample_basename}.tsv"
```

- The `FREYJA_DEMIX` process generates a `.tsv` file that stores lineage abundance results.

### **Running the Command**

```nextflow
    script:
    """
    freyja demix $variant_file $depth_file --output ${sample_basename}.tsv
    """
```

- Calls `freyja demix` with the variant and depth files as inputs.
- Redirects the output to a .tsv file.

Now save the changes you have made to the freyja_demix.nf module.

---