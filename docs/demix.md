# **Writing `freyja_demix.nf` Module**

## **Step 2: Writing the `freyja_demix.nf` Module**  

In this step, we will define the `freyja_demix.nf` module, which contains the `FREYJA_DEMIX` process. This module takes the output from `freyja_variant.nf` module and further analyzes it.

The module:

- Accepts a `.variant` file and a `.depths` file as input.
- Runs `freyja demix` command.
- Produces a `.tsv` file containing the final results.

---

Use your preferred text editor to edit `freyja_demix.nf` file or run: 

```bash
nano modules/freyja_demix.nf
```

---

Here is the full Code for `FREYJA_DEMIX`

```nextflow
process FREYJA_DEMIX {
    
    input:
        path variant_file
        path depth_file

    output:
        path "${sample_basename}.tsv"

    script:
    sample_basename = variant_file.simpleName

        """
        freyja demix $variant_file $depth_file --output ${sample_basename}.tsv
        """
}
```

---

Let's break it down:

### **Process name**
```nextflow
    process FREYJA_DEMIX  { }
```

- The process is named after the tool it runs (FREYJA_DEMIX).
- The curly braces `{}` enclose the process logic.

---

### **Declaring the Input Files**
```nextflow
    input:
        path variant_file
        path depth_file
```

- `variant_file` – The .variant file generated by the `freyja_variant.nf` module
- `depth_file` – The .depths file generated by the `freyja_variant.nf` module
- These files serve as inputs for `FREYJA_DEMIX` process which analyzes the data.

---

### **Declaring the Output File**
```nextflow
    output:
        path "${sample_basename}.tsv"
```

- The `FREYJA_DEMIX` process creates a channel for the generates `.tsv` file

---

### **Running the Command (Script Section)**
This is where the Freyja command is executed.

```nextflow
    script:
    sample_basename = variant_file.baseName

    """
    freyja demix $variant_file $depth_file --output ${sample_basename}.tsv
    """
```

- `sample_basename` = `variant_file.baseName` → Extracts the filename (without extension).
- Calls `freyja demix` with the variant and depth files as inputs.
- `$variant_file` and `$depth_file` → Access input files inside the script.
- `${sample_basename}.tsv` → Defines the output file dynamically.
- Triple quotes (""") allow multi-line commands, making the script easier to read.

---

Now, save your changes to the freyja_demix.nf module!

---